<!DOCTYPE html>
<html>
<head>
  <title>Edit Activity</title>
  <link rel="stylesheet" href="edit.css" />
</head>
<body>
  <h1>Edit Activity</h1>
  <label for="activityId">Enter Activity ID:</label>
  <input type="text" id="activityId" placeholder="Activity ID here" />
  <button id="loadByIdBtn">Load Activity By ID</button>
  <br><br>
  <label for="activityNameSearch">Enter Activity Name:</label>
  <input type="text" id="activityNameSearch" placeholder="Activity Name here" />
  <button id="loadByNameBtn">Load Activity By Name</button>
  <br><br>
  <h3>Or select an activity from the list below:</h3>
  <ul id="activityList"></ul>

  <div class="container">
    <form id="editForm" style="display:none; margin-top:20px;">
      <label for="ActivityName">Activity Name:</label>
      <input type="text" name="ActivityName" id="ActivityName" required /><br />
      <label for="Location">Location:</label>
      <input type="text" name="Location" id="Location" required /><br />
      <label for="Date">Date:</label>
      <input type="date" name="Date" id="Date" required /><br />
      <label for="Time">Time:</label>
      <input type="time" name="Time" id="Time" required /><br />
      <label for="Description">Description:</label>
      <textarea name="Description" id="Description" required></textarea><br />
      <button type="submit">Save Changes</button>
      <button type="button" id="deleteBtn" style="margin-left: 10px;">Delete Activity</button>
    </form>
  </div>

  <p id="message" style="color:red;"></p>

<script>
  const API_URL = "https://activity-manager-oagb.onrender.com";

  const loadByIdBtn = document.getElementById('loadByIdBtn');
  const loadByNameBtn = document.getElementById('loadByNameBtn');
  const activityIdInput = document.getElementById('activityId');
  const activityNameInput = document.getElementById('activityNameSearch');
  const activityListEl = document.getElementById('activityList');
  const editForm = document.getElementById('editForm');
  const message = document.getElementById('message');
  const deleteBtn = document.getElementById('deleteBtn');

  let selectedActivityId = null;

  async function fetchActivityList() {
    try {
      const res = await fetch(`${API_URL}/api/activity-list`);
      const activities = await res.json();
      activityListEl.innerHTML = '';
      activities.forEach(activity => {
        const li = document.createElement('li');
        li.textContent = `${activity.ActivityName} (ID: ${activity._id})`;
        li.addEventListener('click', () => loadActivityById(activity._id));
        activityListEl.appendChild(li);
      });
    } catch (err) {
      message.textContent = err.message;
    }
  }

  async function loadActivityById(id) {
    try {
      const res = await fetch(`${API_URL}/api/activity/${id}`);
      if (!res.ok) throw new Error('Activity not found');
      const activity = await res.json();
      fillForm(activity);
    } catch (err) {
      message.textContent = err.message;
    }
  }

  async function loadActivityByName(name) {
    try {
      const res = await fetch(`${API_URL}/api/activity/name/${encodeURIComponent(name)}`);
      if (!res.ok) throw new Error('Activity not found');
      const activity = await res.json();
      fillForm(activity);
    } catch (err) {
      message.textContent = err.message;
    }
  }

  function fillForm(activity) {
    editForm.ActivityName.value = activity.ActivityName;
    editForm.Location.value = activity.Location;
    editForm.Date.value = activity.Date.slice(0, 10);
    editForm.Time.value = activity.Time;
    editForm.Description.value = activity.Description;
    selectedActivityId = activity._id;
    editForm.style.display = 'block';
  }

  editForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const res = await fetch(`${API_URL}/api/activity/${selectedActivityId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          ActivityName: editForm.ActivityName.value,
          Location: editForm.Location.value,
          Date: editForm.Date.value,
          Time: editForm.Time.value,
          Description: editForm.Description.value,
        })
      });
      if (!res.ok) throw new Error('Failed to update activity');
      message.style.color = 'green';
      message.textContent = 'Activity updated!';
    } catch (err) {
      message.textContent = err.message;
    }
  });

  deleteBtn.addEventListener('click', async () => {
    try {
      const res = await fetch(`${API_URL}/api/activity/${selectedActivityId}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('Failed to delete activity');
      message.style.color = 'green';
      message.textContent = 'Activity deleted!';
      editForm.style.display = 'none';
      fetchActivityList();
    } catch (err) {
      message.textContent = err.message;
    }
  });

  // Load activity list on page load
  fetchActivityList();
</script>
</body>
</html>
